CREATE TABLE TEMPORAL SPEC (
	table_name VARCHAR(255) PRIMARY KEY,
	valid_time VARCHAR(5) CONSTRAINT VALID_TIME_CHECK CHECK (VALID_TIME IN ('STATE', 'EVENT', 'NONE')),
	valid_time_scale VARCHAR(6) CONSTRAINT VALID_TIME_SCALE_CHECK CHECK (VALID_TIME_SCALE IN ('SECOND', 'MINUTE', 'HOUR', 'DAY', 'MONTH', 'YEAR')),
	transaction_time VARCHAR(5) CONSTRAINT TRANSACTION_TIME_CHECK CHECK (TRANSACTION_TIME IN ('STATE', 'NONE')),
	VACUUM CUT-OFF TIMESTAMP
);

DROP TABLE test_table;

-- create table test
CREATE TABLE test_table (
  id INT PRIMARY KEY,
  name VARCHAR2(32) NOT NULL,
  address VARCHAR(1024) NOT NULL
)
AS VALID STATE AND TRANSACTION;

-- insert test data
INSERT INTO test_table VALUES (1, 'Jirka', 'Pod Cestou 13') VALID PERIOD [1985-02-16 - 2000-01-01];
INSERT INTO test_table VALUES (2, 'Roman', 'Velkopavlovická 11') VALID PERIOD [2000-01-01 - FOREVER];
INSERT INTO test_table VALUES (3, 'Ivetka', 'J. Faimonové 7') VALID PERIOD [2003-04-05 - FOREVER];

-- DELETE TESTS
-- Delete all records valid in specified period 
DELETE FROM test_table VALID PERIOD [1990-01-01 - 1995-01-01];
-- / DELETE TESTS

DELETE FROM test_table WHERE id=1;


CREATE TABLE Emp (
 	ID INT NOT NULL,
 	Name VARCHAR2 ( 30 ) NOT NULL,
 		PRIMARY KEY (Name),
 	Salary NUMBER ( 8,2 ) ,
 	Gender VARCHAR2 ( 1 ) ,
 	BirthDate DATE ,
 	DeptName VARCHAR2 ( 30 )
 )
 AS VALID STATE;
 
CREATE TABLE Skill (
 	EmpID INT NOT NULL,
 	Name VARCHAR2 ( 30 ) NOT NULL
 )
 
 AS VALID STATE;
CREATE TABLE Dept (
 	Name VARCHAR2 ( 30 ) NOT NULL,
 PRIMARY KEY (Name),
 	Budget NUMBER (9,0),
 	MgrID INT NOT NULL
 )
 
 AS VALID STATE;

INSERT INTO Emp
 VALUES (1, 'Ed', 20000, 'M', TO_DATE('7/1/1955', 'MM/DD/YYYY'), 'Toy') 
 VALID PERIOD [1982-02-01 - 1987-01-31];
INSERT INTO Emp
 	SELECT (ID, 'Ed', 40000, 'M', TO_DATE('7/1/1955', 'MM/DD/YYYY'), 'Book')
 	FROM Emp
 	WHERE Name = 'Ed'
 VALID PERIOD [1987-04-01 - FOREVER];
 
INSERT INTO Dept
 	SELECT ('Book', 50000, Emp.ID)
 	FROM Emp
 	WHERE Emp.Name = 'Ed'
 VALID PERIOD [1987-04-01 - FOREVER];
 
UPDATE Emp
 SET Name = 'Edward' VALID PERIOD [1988-01-01 - FOREVER]
 WHERE ID = (SELECT DISTINCT ID FROM Emp WHERE Name = 'Ed');
 
UPDATE Emp
 SET SALARY = 30000 VALID PERIOD [1982-06-01 - 1985-01-31]
 WHERE ID = (SELECT DISTINCT ID FROM Emp WHERE Name = 'Ed');
 
UPDATE Emp
 SET SALARY = 40000 VALID PERIOD [1985-02-01 - 1987-01-31]
 WHERE ID = (SELECT DISTINCT ID FROM Emp WHERE Name = 'Ed');
 
INSERT INTO Skill
 	SELECT (ID, 'Typing')
 	FROM Emp
 	WHERE Name = 'Ed'
 VALID PERIOD [1982-04-01 - FOREVER];
 
INSERT INTO Skill
 	SELECT (ID, 'Filing')
 	FROM Emp
 	WHERE Name = 'Ed'
 VALID PERIOD [1985-01-01 - FOREVER];
 
INSERT INTO Skill
 	SELECT (ID, 'Driving')
 	FROM Emp
 	WHERE Name = 'Ed'
 VALID PERIOD [1982-01-01 - 1982-05-01];
 
INSERT INTO Skill
 	SELECT (ID, 'Driving')
 	FROM Emp
 	WHERE Name = 'Ed'
 VALID PERIOD [1984-06-01 - 1988-05-31];
 
INSERT INTO Emp
 VALUES (2, 'Di', 30000, 'F', TO_DATE('10/1/1960', 'MM/DD/YYYY'), 'Toy') 
 VALID PERIOD [1982-01-01 - FOREVER];
 
INSERT INTO Dept
 	SELECT ('Toy', 150000, Emp.ID)
 	FROM Emp
 	WHERE Emp.Name = 'Di'
 VALID PERIOD [1982-01-01 - FOREVER];
 
UPDATE Dept
 SET Budget = 200000 VALID PERIOD [1984-08-01 - 1986-12-31]
 WHERE Name = 'Toy';
 
UPDATE Dept
 SET Budget = 100000 VALID PERIOD [1987-01-01 - FOREVER]
 WHERE Name = 'Toy';
 
UPDATE Emp
 SET SALARY = 40000 VALID PERIOD [1984-08-01 - 1986-08-31]
 WHERE ID = (SELECT DISTINCT ID FROM Emp WHERE Name = 'Di');
 
UPDATE Emp
 SET SALARY = 50000 VALID PERIOD [1986-09-01 - FOREVER]
 WHERE ID = (SELECT DISTINCT ID FROM Emp WHERE Name = 'Di');
 
INSERT INTO Skill
 	SELECT (ID, 'Directing')
 	FROM Emp
 	WHERE ID = (SELECT ID FROM Emp WHERE Name = 'Di')
 VALID PERIOD [1982-01-01 - FOREVER];
 
 
 
 ============================================================================================
 
 CREATE TABLE lekari (
 	id INT NOT NULL PRIMARY KEY,
 	jmeno VARCHAR2(32) NOT NULL,
 	specializace VARCHAR2(32) NOT NULL
 ) AS VALID STATE;
 
 CREATE TABLE pacienti (
 	id INT NOT NULL PRIMARY KEY,
 	jmeno VARCHAR2(32) NOT NULL
 ) AS VALID STATE;
 
 CREATE TABLE diagnozy (
 	pacient INT NOT NULL,
 	diagnoza VARCHAR(32) NOT NULL
 	lekar INT NOT_NULL
 ) AS VALID STATE;
 
 CREATE TABLE leky (
 	pacient INT NOT NULL,
 	lek VARCHAR(32) NOT NULL
 ) AS VALID STATE;
 
 
 INSERT INTO lekari VALUES (1, 'Jan Novák', 'obvodní lékař') VALID PERIOD [1995-01-01 - 2000-01-06];
 INSERT INTO lekari SELECT id, jmeno, 'kardio' FROM lekari WHERE id = 1 VALID PERIOD [2000-01-06 - FOREVER];
 INSERT INTO lekari VALUES (2, 'Pavel Kovář', 'kožní') VALID PERIOD [1998-08-06 - FOREVER];
 INSERT INTO lekari VALUES (3, 'Jana Jandová', 'ORL') VALID PERIOD [2000-04-01 - FOREVER];
 INSERT INTO lekari VALUES (4, 'Pavla Kuncová', 'obvodní lékař') VALID PERIOD [2000-06-01 - FOREVER];
 
 INSERT INTO pacienti VALUES (1, 'Martin Tlustý') VALID PERIOD [1995-06-03 - FOREVER];
 INSERT INTO pacienti VALUES (2, 'Petr Polák') VALID PERIOD [2001-07-18 - FOREVER];
 INSERT INTO pacienti VALUES (3, 'Martina Novotná') VALID PERIOD [2002-03-13 - 2005-09-03];
 INSERT INTO pacienti VALUES (4, 'Alena Adámková') VALID PERIOD [2005-06-02 - FOREVER];
 
 INSERT INTO diagnozy VALUES (1, 'chřipka', 1) VALID PERIOD [1995-06-03 - 1995-06-13];
 INSERT INTO diagnozy VALUES (1, 'angína', 1) VALID PERIOD [1995-06-13 - 1995-06-20];
 INSERT INTO diagnozy VALUES (2, 'infarkt', 1) VALID PERIOD [2004-06-03 - 2004-08-08];
 INSERT INTO diagnozy VALUES (3, 'popáleniny', 2) VALID PERIOD [2001-01-02 - 2001-06-06];
 INSERT INTO diagnozy VALUES (4, 'zánět stř. ucha', 3) VALID PERIOD [2004-12-06 - 2005-01-06];
 INSERT INTO diagnozy VALUES (1, 'angína', 4) VALID PERIOD [2003-08-03 - 2003-08-17];
 INSERT INTO diagnozy VALUES (3, 'nachlazení', 4) VALID PERIOD [2004-10-13 - 2004-10-20];
 INSERT INTO diagnozy VALUES (2, 'omrzliny', 2) VALID PERIOD [2005-01-03 - 2005-02-03];

 INSERT INTO leky VALUES (1, 'paralen') VALID PERIOD [1995-06-03 - 1995-06-13];
 INSERT INTO leky VALUES (1, 'penicilin') VALID PERIOD [1995-06-13 - 1995-06-20];
 INSERT INTO leky VALUES (1, 'augmentin') VALID PERIOD [2003-08-03 - 2003-08-17];
 INSERT INTO leky VALUES (2, 'aktiferrin') VALID PERIOD [2004-06-03 - FOREVER];
 INSERT INTO leky VALUES (2, 'avenoc') VALID PERIOD [2005-10-08 - 2006-03-02];
 INSERT INTO leky VALUES (3, 'betadine') VALID PERIOD [2001-01-02 - 2001-03-04];
 INSERT INTO leky VALUES (3, 'aciclovir') VALID PERIOD [2001-03-04 - 2001-06-06];
 INSERT INTO leky VALUES (3, 'paralen') VALID PERIOD [2004-10-13 - 2004-10-20];
 INSERT INTO leky VALUES (2, 'betadine') VALID PERIOD [2005-01-03 - 2005-02-03];
 INSERT INTO leky VALUES (2, 'balmandol') VALID PERIOD [2005-01-03 - 2005-01-13];
 INSERT INTO leky VALUES (4, 'oxafirol') VALID PERIOD [2004-12-06 - 2005-01-06];